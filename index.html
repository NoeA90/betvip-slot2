<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BET300 ¬∑ Promo interactiva</title>
<meta name="theme-color" content="#0b0f1e"/>

<!-- Meta Pixel base (reemplaz√° por tu ID) -->
<script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', 'YOUR_PIXEL_ID');     /* ‚Üê tu Pixel */
  fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=YOUR_PIXEL_ID&ev=PageView&noscript=1"/></noscript>

<style>
:root{
  --bg:#0b0f1e; --panel:#111631; --panel2:#0e132f; --border:#1d2250;
  --text:#e8ebff; --muted:#b8bee6; --accent:#22d3ee; --accent2:#7c4dff; --ok:#25D366;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;color:var(--text);background:var(--bg);font:16px/1.35 system-ui,-apple-system,Segoe UI,Roboto}

/* header pills */
.container{max-width:980px;margin:0 auto;padding:16px}
.card{background:var(--panel2);border:1px solid var(--border);border-radius:18px;padding:14px}
.pill{display:inline-block;padding:6px 10px;border:1px solid var(--border);border-radius:999px;
  background:linear-gradient(90deg,rgba(124,77,255,.14),rgba(0,209,255,.14)); color:var(--muted);font-size:12px;margin-right:8px}
.brand{display:inline-block;background:linear-gradient(90deg,#ffb36b,#ff7ab6);color:#0b0f1e;
  font-weight:900;border-radius:16px;padding:8px 14px;margin-right:8px}

/* grid */
.grid{display:grid;gap:16px;grid-template-columns:minmax(0,1fr)}
@media(min-width:900px){.grid{grid-template-columns:1.1fr .9fr}}

/* stage */
.stage{position:relative;display:flex;align-items:center;justify-content:center}
.wrap{width:100%;max-width:560px;margin:auto}
canvas{width:100%;height:auto;display:block;border-radius:22px}

/* pointer */
.pointer{
  position:absolute; top:22px; left:50%; transform:translateX(-50%);
  width:0; height:0; border-left:18px solid transparent;border-right:18px solid transparent;border-bottom:28px solid var(--accent);
  filter:drop-shadow(0 6px 12px rgba(34,211,238,.35)); z-index:2;
}

/* right panel */
.panel{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px}
.h1{font-size:24px;font-weight:800;margin:0 0 8px}
.muted{color:var(--muted)}

/* stat badge */
.badge{display:inline-grid;place-items:center;width:82px;height:52px;border-radius:12px;
  background:radial-gradient(120% 120% at 50% 0%, rgba(0,209,255,.25), rgba(124,77,255,.25));
  font-weight:800;font-size:18px;margin-right:10px}

/* buttons */
.btn{appearance:none;border:0;cursor:pointer;border-radius:14px;font-weight:800;color:#0d132a;
  padding:14px 16px;background:linear-gradient(90deg,#ffb36b,#ff7ab6);box-shadow:0 10px 24px rgba(0,0,0,.35)}
.btn.secondary{background:#19214b;color:var(--text);border:1px solid var(--border)}
.btn.ok{background:var(--ok);color:#08220e}
.btn.block{width:100%}

/* sticky mobile CTA row */
.cta-row{
  position:sticky; bottom:0; left:0; right:0; z-index:30; padding:12px;
  background:linear-gradient(180deg,rgba(10,12,25,0),rgba(10,12,25,.85) 35%, rgba(10,12,25,.95));
  display:flex; gap:12px;
}
.cta-row .btn{flex:1}

/* hide reiniciar en web */
@media(min-width:900px){ #resetBtn{display:none} }

/* WhatsApp FAB */
.fab{
  position:fixed; right:18px; bottom:88px; width:74px; height:74px; border-radius:50%;
  background:var(--ok) url('img/whatsapp.svg') center/38px 38px no-repeat;
  box-shadow:0 16px 40px rgba(37,211,102,.42), inset 0 0 18px rgba(255,255,255,.3);
  border:0; cursor:pointer; z-index:40;
  animation:heartbeat 1.6s ease-in-out infinite;
}
@media(min-width:900px){ .fab{bottom:22px} }

/* efecto latido (tambi√©n lo uso en el bot√≥n m√≥vil ‚ÄúReclamar‚Äù) */
@keyframes heartbeat{
  0%{transform:scale(1)} 25%{transform:scale(1.06)} 40%{transform:scale(0.98)}
  60%{transform:scale(1.06)} 100%{transform:scale(1)}
}
.pulse{animation:heartbeat 1.6s ease-in-out infinite}

/* little switches */
.switch{display:inline-flex;align-items:center;gap:8px}
.toggle{
  --w:54px; position:relative; width:var(--w); height:30px; border-radius:999px; background:#21305b; border:1px solid var(--border);
}
.toggle i{position:absolute; top:2px; left:2px; width:26px; height:26px; border-radius:50%; background:#8aa0ff; transition:.18s}
.toggle.on{background:#153a2a;border-color:#1a5}
.toggle.on i{left:calc(100% - 28px); background:#79ffb6}

/* helper */
.center{text-align:center}
.spacer{height:10px}
</style>
</head>
<body>

<div class="container">
  <div class="card">
    <span class="brand">BET300</span>
    <span class="pill">Promo interactiva ¬∑ v√°lida <b>hoy</b></span>
    <span class="pill" id="deadlinePill">‚è≥ Tiempo limitado <b id="countdown">--:--</b></span>
    <span class="pill switch">Sonido:
      <span id="soundToggle" class="toggle on" role="switch" aria-checked="true"><i></i></span>
    </span>
  </div>

  <div class="grid">
    <!-- WHEEL -->
    <div class="panel">
      <div class="stage">
        <div class="wrap"><canvas id="wheel" width="640" height="640"></canvas></div>
        <div class="pointer"></div>
      </div>
    </div>

    <!-- INFO -->
    <div class="panel" id="infoPanel">
      <div class="center" style="display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:10px">
        <div class="badge" id="badge">-</div>
        <div>
          <div class="h1" id="title">Ten√©s 1 giro disponible</div>
          <div class="muted" id="subtitle">Los premios se acreditan con tu <b>pr√≥xima carga m√≠nima</b>.</div>
        </div>
      </div>

      <!-- Desktop CTAs -->
      <div class="spacer"></div>
      <div class="desk-ctas" style="display:grid;gap:10px;">
        <button id="spinBtn" class="btn block">üé∞ Girar ahora</button>
        <button id="resetBtn" class="btn secondary block">Reiniciar</button>
      </div>
    </div>
  </div>
</div>

<!-- Mobile sticky CTAs -->
<div class="cta-row" id="mobileBar">
  <button id="spinBtnMobile" class="btn">üé∞ Girar</button>
  <button id="claimBtnMobile" class="btn ok pulse">üì≤ Reclamar</button>
</div>

<!-- WhatsApp FAB -->
<button id="fab" class="fab" aria-label="WhatsApp"></button>

<!-- Audios -->
<audio id="sSpin" preload="auto" src="sounds/spin.mp3"></audio>
<audio id="sWin"  preload="auto" src="sounds/win.mp3"></audio>

<script>
/* ================== Config ================== */
const LABELS = [
  "$2.000","10%","$3.000","20%","$4.000","30%","$5.000","40%",
  "$6.000","50%","$7.000","$8.000","$9.000","$10.000","$2.000","10%"
]; // 16 segmentos intercalados
const COLORS = ["#96e7ff","#9ea5ff","#ffd3a6","#ff9bd1","#b2ffdd","#ffd3a6",
                "#c9b8ff","#ffa5d6","#a8ffe7","#ffd3a6","#9fd1ff","#ffc0e3",
                "#b9ffd7","#ffd3a6","#9ed2ff","#bba8ff"];
const wpNumbers = { principal:"5491157737173", pc1:"5491138601132", pc2:"5491138214312", pc3:"5491168392647" };
const wpMsg = "Hola, obtuve *%PRIZE%* en la promo y quiero reclamarlo ‚úÖ";

/* ================== Estado ================== */
const wheel = document.getElementById('wheel');
const ctx   = wheel.getContext('2d');
let cssW=0,cx=0,cy=0,r=0;
let angle=0, spinning=false, prize=null;

const spinBtn = document.getElementById('spinBtn');
const spinBtnMobile = document.getElementById('spinBtnMobile');
const resetBtn = document.getElementById('resetBtn');
const badge = document.getElementById('badge');
const title = document.getElementById('title');
const subtitle = document.getElementById('subtitle');
const fab = document.getElementById('fab');
const claimBtnMobile = document.getElementById('claimBtnMobile');
const sSpin = document.getElementById('sSpin');
const sWin  = document.getElementById('sWin');
const soundToggle = document.getElementById('soundToggle');
let soundOn = true;

/* pc param */
const params = new URLSearchParams(location.search);
const pc = params.get('pc');
let WP = wpNumbers.principal;
if(pc==='1') WP = wpNumbers.pc1;
if(pc==='2') WP = wpNumbers.pc2;
if(pc==='3') WP = wpNumbers.pc3;

/* ================== Helper ================== */
function norm(a){const T=Math.PI*2;return ((a%T)+T)%T}
function byPointer(el, fn){
  let armed=true;
  const handler = (e)=>{ e.preventDefault(); if(!armed) return; armed=false; fn(); setTimeout(()=>armed=true,250); };
  el.addEventListener('pointerup', handler, {passive:false});
}
function setSize(){
  const dpr = window.devicePixelRatio||1;
  const wrap = document.querySelector('.wrap').getBoundingClientRect();
  const w = Math.min(560, Math.max(300, wrap.width));
  cssW=w;
  wheel.width = Math.floor(w*dpr);
  wheel.height= Math.floor(w*dpr);
  wheel.style.width=w+'px'; wheel.style.height=w+'px';
  ctx.setTransform(dpr,0,0,dpr,0,0);
  cx = wheel.width/dpr/2; cy = wheel.height/dpr/2; r = Math.min(cx,cy)-14;
  draw(angle);
}
window.addEventListener('resize', ()=>{clearTimeout(window.__rs); window.__rs=setTimeout(setSize,120)});

/* ================== Draw ================== */
function draw(a){
  ctx.clearRect(0,0,wheel.width,wheel.height);
  const n = LABELS.length; const arc = Math.PI*2/n;
  // rim
  ctx.beginPath(); ctx.arc(cx,cy,r+16,0,Math.PI*2); ctx.lineWidth=18; ctx.strokeStyle="rgba(190,205,255,.45)"; ctx.stroke();

  for(let i=0;i<n;i++){
    const s=a+i*arc, e=s+arc;
    // slice
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,r,s,e); ctx.closePath();
    ctx.fillStyle = COLORS[i%COLORS.length]; ctx.fill();
    ctx.strokeStyle="rgba(10,15,35,.35)"; ctx.lineWidth=2; ctx.stroke();

    // label
    ctx.save(); ctx.translate(cx,cy); ctx.rotate(s+arc/2);
    ctx.textAlign="right"; ctx.fillStyle="#091024";
    const f = (cssW<360)? "700 22px system-ui" : (cssW<420? "700 26px system-ui" : "700 30px system-ui");
    ctx.font = f;
    ctx.fillText(LABELS[i], r-22, 10);
    ctx.restore();
  }
  // bulbs
  const bulbs = n; const br = r+10;
  for(let i=0;i<bulbs;i++){
    const t=a+i*arc + arc/2;
    const x=cx+Math.cos(t)*br, y=cy+Math.sin(t)*br;
    ctx.beginPath(); ctx.arc(x,y,6,0,Math.PI*2);
    ctx.fillStyle= i%2? "rgba(255,255,255,.85)" : "rgba(180,200,255,.7)"; ctx.fill();
  }
  // hub
  ctx.beginPath(); ctx.arc(cx,cy,Math.max(34, r*0.11), 0, Math.PI*2);
  ctx.fillStyle="#0d1233"; ctx.fill(); ctx.lineWidth=6; ctx.strokeStyle="rgba(124,77,255,.5)"; ctx.stroke();
}

/* where the pointer lands (top) */
function winnerIndex(a){
  const n=LABELS.length, arc=Math.PI*2/n, pointer=Math.PI*1.5;
  let best=0, bd=1e9;
  for(let i=0;i<n;i++){
    const c=norm(a+i*arc+arc/2);
    let d=Math.abs(norm(c-pointer)); if(d>Math.PI) d=(Math.PI*2)-d;
    if(d<bd){bd=d; best=i;}
  }
  return best;
}

/* anim */
function animateTo(target, ms, done){
  const start=performance.now(), from=angle;
  (function loop(t){
    const k=Math.min(1,(t-start)/ms); const ease=1-Math.pow(1-k,3);
    angle=from+(target-from)*ease; draw(angle);
    if(k<1) requestAnimationFrame(loop); else done&&done();
  })(start);
}

/* audio toggle */
soundToggle.addEventListener('click', ()=>{
  soundOn = !soundOn;
  soundToggle.classList.toggle('on', soundOn);
});

/* claim: build wa link + tracking */
function goWhatsApp(amountLabel){
  const msg = wpMsg.replace("%PRIZE%", amountLabel);
  const url = `https://wa.me/${WP}?text=${encodeURIComponent(msg)}`;
  try{ fbq('trackCustom','WhatsAppClick',{pc:pc||'principal', prize: amountLabel}); }catch(_){}
  location.href = url;
}

/* set won UI */
function setWon(label){
  badge.textContent = label;
  title.textContent = "üéâ ¬°Premio obtenido!";
  subtitle.innerHTML = `Recib√≠s <b>${label} en fichas</b> con tu pr√≥xima carga.`;
  if(soundOn){ sWin.currentTime=0; sWin.play().catch(()=>{}); }
  // wire claim buttons
  claimBtnMobile.onclick = ()=> goWhatsApp(label);
  fab.onclick = ()=> goWhatsApp(label);
}

/* spin */
function spin(){
  if(spinning) return;
  spinning=true;
  if(soundOn){ sSpin.currentTime=0; sSpin.play().catch(()=>{}); }
  const extra = 5 + Math.random()*1.5;
  const rnd = Math.random()*Math.PI*2;
  const target = angle + Math.PI*2*extra + rnd;
  animateTo(target, 3000, ()=>{
    angle = target;
    const idx = winnerIndex(angle);
    const label = LABELS[idx];
    prize = label;
    setWon(label);
    localStorage.setItem('spin_done','1');
    localStorage.setItem('spin_label', label);
    spinning=false;
  });
}

/* reset */
function resetSpin(){
  localStorage.removeItem('spin_done');
  localStorage.removeItem('spin_label');
  prize=null; badge.textContent='-';
  title.textContent='Ten√©s 1 giro disponible';
  subtitle.innerHTML='Los premios se acreditan con tu <b>pr√≥xima carga m√≠nima</b>.';
}

/* bind spins with pointer (m√≥vil + desktop) */
byPointer(spinBtn, spin);
byPointer(spinBtnMobile, spin);
byPointer(fab, ()=>{ if(prize){ goWhatsApp(prize);} });

if(resetBtn) byPointer(resetBtn, resetSpin);

/* countdown a hoy 23:59 */
function deadlineTS(){
  const n=new Date();
  const end=new Date(n.getFullYear(), n.getMonth(), n.getDate(), 23,59,0,0);
  if(end.getTime()<Date.now()) end.setDate(end.getDate()+1);
  return end.getTime();
}
const END_KEY='promo_end_ts';
if(!localStorage.getItem(END_KEY)) localStorage.setItem(END_KEY, String(deadlineTS()));
function fmt(ms){ const s=Math.floor(ms/1000);
  const h=Math.floor(s/3600), m=Math.floor((s%3600)/60), ss=s%60;
  return (h>0? h+':':'')+String(m).padStart(2,'0')+':'+String(ss).padStart(2,'0');}
function tick(){
  const ms= Math.max(0, parseInt(localStorage.getItem(END_KEY)||'0',10) - Date.now());
  document.getElementById('countdown').textContent = fmt(ms);
  if(ms<=0){ spinBtn.disabled=spinBtnMobile.disabled=true; }
}
setInterval(tick, 1000); tick();

/* restore state */
const saved = localStorage.getItem('spin_label');
if(saved){ setWon(saved); }

/* init */
setSize(); draw(angle);

/* claim buttons initial (in caso no haya premio a√∫n) */
claimBtnMobile.onclick = ()=> goWhatsApp(prize || '-');
fab.onclick = ()=> goWhatsApp(prize || '-');
</script>
</body>
</html>
