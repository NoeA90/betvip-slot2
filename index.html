<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BET300 ¬∑ Promo</title>
<meta name="theme-color" content="#0b0f1e">
<style>
:root{
  --bg:#070a18;--panel:#0e1331;--text:#f3f6ff;--muted:#b9bedf;
  --border:#1d2353;--neon:#16f1ff;--ok:#25D366;--accent:#7a5bff;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;background:radial-gradient(1600px 900px at 50% -10%,#14184e 0%,#070a18 55%) fixed;color:var(--text);font:16px/1.35 system-ui,-apple-system,Segoe UI,Roboto}
.container{max-width:980px;margin:0 auto;padding:14px}
.card{background:#0b1030;border:1px solid var(--border);border-radius:18px;padding:14px;box-shadow:0 18px 60px rgba(0,0,0,.45)}
@media (max-width:560px){.container{padding:0}.card{border-radius:0;border-left:0;border-right:0}}
.head{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:2px 0 12px}
.logo{font-weight:900;letter-spacing:.5px;padding:6px 12px;border-radius:12px;background:linear-gradient(90deg,#ffea8a,#ffb648 40%,#ff7a4f);color:#24170a;text-shadow:0 1px 0 #fff8}
.badge{padding:6px 10px;border-radius:999px;border:1px solid #232b66;background:linear-gradient(90deg,rgba(124,77,255,.22),rgba(0,209,255,.22));font-size:12px}
.count{display:inline-flex;gap:6px;align-items:center;padding:4px 10px;border-radius:999px;font-weight:800;font-variant-numeric:tabular-nums;color:#ffef95;background:rgba(255,204,0,.14);border:1px solid rgba(255,204,0,.35)}

.grid{display:grid;gap:14px;grid-template-columns:minmax(0,1fr)}
@media(min-width:900px){.grid{grid-template-columns:1.05fr .95fr}}

.panel{background:linear-gradient(180deg,#0b1138,#0c1130);border:1px solid var(--border);border-radius:16px;padding:14px}
.stage{position:relative;display:flex;justify-content:center;min-height:340px}
.wrap{width:100%;max-width:560px;margin:auto}
canvas{display:block;width:100%;height:auto}

.pointer{position:absolute;top:8px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:18px solid transparent;border-right:18px solid transparent;border-bottom:28px solid var(--neon);filter:drop-shadow(0 0 16px rgba(22,241,255,.6));z-index:2}

.center{text-align:center}
h1,h2,h3,p{margin:0 0 8px}
.muted{color:var(--muted)}
.stat{display:flex;align-items:center;gap:10px;justify-content:center;margin:8px 0 12px}
.pill{min-width:78px;height:48px;border-radius:12px;background:radial-gradient(100% 100% at 50% 0%, rgba(0,209,255,.35), rgba(124,77,255,.35));display:grid;place-items:center;font-weight:900;font-size:18px}

.row{display:flex;gap:10px}
.btn{appearance:none;border:none;cursor:pointer;padding:12px 16px;border-radius:12px;font-weight:900;letter-spacing:.2px;background:linear-gradient(90deg,#ffdb70,#ff9b4d 45%,#ff5aa4);color:#24110b;width:100%;text-shadow:0 1px 0 #fff7;box-shadow:0 10px 26px rgba(0,0,0,.5)}
.btn.secondary{background:#18204f;color:#e6e9ff;border:1px solid #2a316b;text-shadow:none}
.btn.ok{background:linear-gradient(90deg,#4dffb3,#12e57c);color:#072015;text-shadow:0 1px 0 #d9ffe6}
.btn:disabled{opacity:.55;cursor:not-allowed}

.toggle{margin-left:auto;display:flex;align-items:center;gap:8px}
.switch{position:relative;width:52px;height:28px;background:#1a2156;border:1px solid #2a3170;border-radius:999px;cursor:pointer}
.switch::after{content:"";position:absolute;top:3px;left:3px;width:22px;height:22px;background:#cfd7ff;border-radius:50%;transition:transform .2s}
.switch.on{background:#15d78a;border-color:#15d78a}
.switch.on::after{transform:translateX(24px)}

.promo{display:flex;gap:10px;align-items:flex-start;margin-top:10px;padding:12px;border:1px dashed #2a2f67;border-radius:12px}
.toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:#0e1433;border:1px solid #242b62;border-radius:10px;padding:10px 14px;font-size:14px;opacity:0;transition:.25s;box-shadow:0 12px 30px rgba(0,0,0,.5);z-index:60}
.toast.show{opacity:1}
.confetti{position:fixed;inset:0;pointer-events:none;z-index:50}
.confetti i{position:absolute;width:10px;height:14px;opacity:0;top:-20px;border-radius:2px;animation:drop 1.6s linear forwards}
@keyframes drop{8%{opacity:1}100%{transform:translateY(110vh) rotate(360deg);opacity:0}}

/* FAB WhatsApp */
.fab{position:fixed;right:14px;bottom:84px;z-index:70;background:#25D366;border:none;border-radius:999px;padding:12px 16px;display:flex;align-items:center;gap:10px;box-shadow:0 16px 40px rgba(0,0,0,.55);cursor:pointer}
.fab span{font-weight:900;color:#0b0f1e;text-shadow:0 1px 0 #fff9}
.fab svg{width:36px;height:36px;display:block;filter:drop-shadow(0 2px 4px rgba(0,0,0,.35))}
@media(max-width:430px){.fab span{display:none}.fab svg{width:46px;height:46px}}
.fab:disabled{opacity:.6;cursor:not-allowed}
</style>
</head>
<body>

<div id="confetti" class="confetti" aria-hidden="true"></div>
<div id="toast" class="toast">Ya usaste tu giro de hoy</div>

<div class="container">
  <div class="card">
    <div class="head">
      <div class="logo">BET300</div>
      <span class="badge">Promo interactiva ¬∑ v√°lida <b id="today"></b></span>
      <span class="badge">‚è≥ Tiempo limitado <span class="count" id="countdown">--:--</span></span>

      <!-- Toggle sonido -->
      <div class="toggle">
        <span class="badge" id="soundLabel">Sonido: OFF</span>
        <div id="soundSwitch" class="switch" role="switch" aria-checked="false" tabindex="0"></div>
      </div>
    </div>

    <div class="grid">
      <div class="panel">
        <div class="stage">
          <div class="wrap"><canvas id="wheel" width="640" height="640"></canvas></div>
          <div class="pointer" aria-hidden="true"></div>
        </div>
      </div>

      <div class="panel">
        <div class="center">
          <div class="stat">
            <div class="pill" id="pill">-</div>
            <div>
              <h1 id="title">Ten√©s 1 giro disponible</h1>
              <p class="muted" id="subtitle">Los premios se acreditan con tu <b>pr√≥xima carga m√≠nima</b>.</p>
            </div>
          </div>
        </div>

        <div class="row">
          <button id="spinBtn" class="btn">üé∞ Girar ahora</button>
          <button id="resetBtn" class="btn secondary" title="Solo pruebas locales">Reiniciar</button>
        </div>

        <button id="claimBtn" class="btn ok" style="margin-top:10px" disabled>üì≤ Reclamar por WhatsApp</button>

        <div class="promo">
          <div style="font-weight:700">‚ö°</div>
          <div class="muted">Beneficio por tiempo limitado. Si el contador llega a cero, se cierra la promo.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- FAB WhatsApp (inline SVG) -->
<button id="fabWA" class="fab" disabled aria-label="WhatsApp">
  <svg viewBox="0 0 32 32" aria-hidden="true"><path fill="#fff" d="M16 3C9.37 3 4 8.37 4 15c0 2.24.63 4.34 1.73 6.12L4 29l8.13-1.69A11.9 11.9 0 0 0 16 27c6.63 0 12-5.37 12-12S22.63 3 16 3zm0 22.5c-1.72 0-3.35-.45-4.78-1.23l-.34-.19-4.3.9.88-4.2-.2-.35A9.45 9.45 0 0 1 6.5 15c0-5.24 4.26-9.5 9.5-9.5s9.5 4.26 9.5 9.5-4.26 9.5-9.5 9.5zm5.28-6.32c-.29-.15-1.7-.84-1.97-.93-.27-.1-.47-.15-.68.15-.2.29-.78.93-.95 1.12-.18.2-.35.22-.64.07-.29-.15-1.22-.45-2.32-1.43-.86-.76-1.44-1.7-1.6-1.99-.17-.29-.02-.45.13-.6.14-.14.29-.36.43-.54.15-.18.2-.29.29-.49.1-.2.05-.37-.02-.52-.07-.15-.68-1.64-.93-2.25-.24-.58-.49-.5-.68-.5-.18 0-.37-.02-.57-.02-.2 0-.52.07-.79.37-.27.29-1.04 1.02-1.04 2.49s1.07 2.88 1.22 3.08c.15.2 2.1 3.19 5.09 4.37.71.31 1.26.49 1.69.63.71.23 1.35.2 1.86.12.57-.08 1.7-.69 1.94-1.36.24-.67.24-1.24.17-1.36-.07-.12-.26-.19-.55-.34z"/></svg>
  <span>Chatear ahora</span>
</button>

<script>
/* =================== Config =================== */
const AMOUNTS=[2000,3000,4000,5000,6000,7000,8000,9000,10000];
const PERCENTS=[10,20,30,40,50];
const PRIZES=[];(function(){const m=Math.max(AMOUNTS.length,PERCENTS.length);for(let i=0;i<m;i++){if(AMOUNTS[i]!=null)PRIZES.push({type:'$',value:AMOUNTS[i]});if(PERCENTS[i]!=null)PRIZES.push({type:'%',value:PERCENTS[i]});}})();
const COLORS=["#7ab8ff","#7a5bff","#4df0ff","#ff9bd1","#ffd166","#7cf7ad","#a1a9ff","#ff6ad5","#fff3a6","#8ad8ff","#c7b2ff","#ffd6f0","#9cf7d9","#ffc6a5"];
const SEGS=PRIZES.length;

const WP_NUMBERS={principal:"5491157737173",pc1:"5491138601132",pc2:"5491138214312",pc3:"5491168392647"};
const WP_MSG_TEMPLATE="Hola! Quiero reclamar mi premio: %PRIZE%. Llegu√© desde %SOURCE%.";

/* =================== Estado / elementos =================== */
const wheel=document.getElementById('wheel'), ctx=wheel.getContext('2d');
const spinBtn=document.getElementById('spinBtn'), resetBtn=document.getElementById('resetBtn');
const claimBtn=document.getElementById('claimBtn'), pill=document.getElementById('pill');
const titleEl=document.getElementById('title'), subtitle=document.getElementById('subtitle');
const countdownEl=document.getElementById('countdown'), toast=document.getElementById('toast');
const confetti=document.getElementById('confetti'), fabWA=document.getElementById('fabWA');
const soundSwitch=document.getElementById('soundSwitch'), soundLabel=document.getElementById('soundLabel');

const params=new URLSearchParams(location.search);
const pc=params.get('pc');
let WP=WP_NUMBERS.principal; if(pc==='1')WP=WP_NUMBERS.pc1; if(pc==='2')WP=WP_NUMBERS.pc2; if(pc==='3')WP=WP_NUMBERS.pc3;

(function(){const d=new Date();document.getElementById('today').textContent=`hoy ${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}`})();

/* =================== Canvas & layers =================== */
let angle=0,cx=0,cy=0,r=0,cssW=0, arc=0;
const TWO=Math.PI*2, pointerAngle=Math.PI*1.5;

const off=document.createElement('canvas'), octx=off.getContext('2d'); // capa de la rueda
function getWrapWidth(){const w=document.querySelector('.wrap');return w?Math.floor(w.getBoundingClientRect().width):Math.floor(innerWidth*.95)}
function setSize(){
  const dpr=devicePixelRatio||1;
  const w=Math.min(560,Math.max(280,getWrapWidth())); cssW=w;
  wheel.width=Math.floor(w*dpr); wheel.height=Math.floor(w*dpr); wheel.style.width=w+'px'; wheel.style.height=w+'px';
  ctx.setTransform(dpr,0,0,dpr,0,0);
  cx=wheel.width/dpr/2; cy=wheel.height/dpr/2; r=Math.min(cx,cy)-12; arc=TWO/SEGS;

  // preparar offscreen del mismo tama√±o CSS (no dpr) para dibujar n√≠tido
  off.width=w; off.height=w; off.style.width=w+'px'; off.style.height=w+'px';
  drawBase(off.getContext('2d'), w/2, w/2, Math.min(w/2,w/2)-12);
  draw(angle); // primer render
}
addEventListener('resize',()=>{clearTimeout(window.__wTo);window.__wTo=setTimeout(setSize,120)});

/* dibuja la rueda est√°tica (segmentos + aro + LEDs) en offscreen */
function drawBase(c, x, y, rad){
  c.clearRect(0,0,off.width,off.height);
  // aro exterior met√°lico
  const rimO=rad, rimI=rad-16;
  const g=c.createLinearGradient(x-rad,y-rad,x+rad,y+rad); g.addColorStop(0,'#f9fbff'); g.addColorStop(.5,'#cad6ff'); g.addColorStop(1,'#eef1ff');
  c.beginPath(); c.arc(x,y,rimO,0,TWO); c.arc(x,y,rimI,0,TWO,true); c.fillStyle=g; c.fill();

  // segmentos
  const wheelR=rad-18, inset=14;
  const font = cssW<=340? "900 20px system-ui,-apple-system,Segoe UI":
               cssW<=380? "900 24px system-ui,-apple-system,Segoe UI":
               cssW<=440? "900 28px system-ui,-apple-system,Segoe UI":"900 32px system-ui,-apple-system,Segoe UI";
  for(let i=0;i<SEGS;i++){
    const s=i*arc, e=s+arc;
    c.beginPath(); c.moveTo(x,y); c.arc(x,y,wheelR,s,e); c.fillStyle=COLORS[i%COLORS.length]; c.fill();
    c.strokeStyle="rgba(6,10,26,.5)"; c.lineWidth=1.5; c.stroke();
    const p=PRIZES[i], label=p.type==='%'? (p.value+"%"):("$"+p.value.toLocaleString("es-AR"));
    c.save(); c.translate(x,y); c.rotate(s+arc/2); c.textAlign="right"; c.fillStyle="#0a1028"; c.font=font; c.fillText(label,wheelR-inset,12); c.restore();
  }

  // corona de LEDs (posiciones guardadas; brillo en draw() para animar)
  off._leds=[];
  const ledsCount = Math.round(TWO * (wheelR-6) / 22); // densidad
  for(let i=0;i<ledsCount;i++){
    const a=i*(TWO/ledsCount);
    const lx=x+Math.cos(a)*(wheelR+6);
    const ly=y+Math.sin(a)*(wheelR+6);
    off._leds.push({x:lx,y:ly,phase:i%2});
  }

  // centro fijo
  const cR=Math.max(34,(rad*0.11));
  c.beginPath(); c.arc(x,y,cR,0,TWO); c.fillStyle="#0b1034"; c.fill();
}

/* dibuja frame actual (rueda rotada + LEDs parpadeo) */
let ledTick=0;
function draw(a){
  ctx.clearRect(0,0,wheel.width,wheel.height);

  // rueda rotada (usamos offscreen para que nunca "desaparezca")
  ctx.save();
  ctx.translate(cx,cy); ctx.rotate(a); ctx.drawImage(off, -off.width/2, -off.height/2, off.width, off.height);
  ctx.restore();

  // LEDs animados
  ledTick++;
  const leds = off._leds||[];
  for(const d of leds){
    const bright = ((ledTick/8 + d.phase) % 2) < 1 ? 1 : 0.35;
    const grd = ctx.createRadialGradient(d.x,d.y,0,d.x,d.y,6);
    grd.addColorStop(0, `rgba(255,255,255,${0.85*bright})`);
    grd.addColorStop(0.6, `rgba(124,77,255,${0.9*bright})`);
    grd.addColorStop(1, `rgba(124,77,255,0)`);
    ctx.fillStyle=grd; ctx.beginPath(); ctx.arc(d.x,d.y,6,0,TWO); ctx.fill();
  }
}

/* =================== Audio (sin archivos) =================== */
let audioOn=false, ctxA=null;
function initAudio(){ if(ctxA) return; try{ ctxA = new (window.AudioContext||window.webkitAudioContext)(); }catch{} }
function playBeep(freq=900, len=0.045, vol=0.2){
  if(!audioOn || !ctxA) return;
  const t=ctxA.currentTime, o=ctxA.createOscillator(), g=ctxA.createGain();
  o.type='square'; o.frequency.setValueAtTime(freq,t);
  g.gain.setValueAtTime(vol,t); g.gain.exponentialRampToValueAtTime(0.0001, t+len);
  o.connect(g).connect(ctxA.destination); o.start(t); o.stop(t+len);
}
function playWin(){
  if(!audioOn || !ctxA) return;
  const t=ctxA.currentTime, o=ctxA.createOscillator(), g=ctxA.createGain();
  o.type='triangle'; o.frequency.setValueAtTime(520,t);
  o.frequency.linearRampToValueAtTime(880,t+0.22);
  g.gain.setValueAtTime(0.0001,t); g.gain.exponentialRampToValueAtTime(0.4,t+0.01);
  g.gain.exponentialRampToValueAtTime(0.0001,t+0.35);
  o.connect(g).connect(ctxA.destination); o.start(t); o.stop(t+0.36);
}

/* Toggle sonido */
function setSound(on){
  audioOn=!!on; soundSwitch.classList.toggle('on',audioOn); soundSwitch.setAttribute('aria-checked', audioOn?'true':'false');
  soundLabel.textContent = 'Sonido: ' + (audioOn?'ON':'OFF');
  if(audioOn) initAudio();
}
soundSwitch.addEventListener('click',()=>setSound(!audioOn));
soundSwitch.addEventListener('keydown',e=>{if(e.key===' '||e.key==='Enter'){e.preventDefault(); setSound(!audioOn)}});

/* =================== Juego =================== */
function toastMsg(msg){toast.textContent=msg;toast.classList.add('show');setTimeout(()=>toast.classList.remove('show'),1600)}
function prizeText(p){return p.type==='%'? (p.value+"% extra"):("$"+p.value.toLocaleString("es-AR")+" en fichas")}
function waMsgFor(txt){const src=(params.get('utm_source')||'meta').toUpperCase();return WP_MSG_TEMPLATE.replace('%PRIZE%',txt).replace('%SOURCE%',src)}
function confettiBurst(){confetti.innerHTML='';for(let i=0;i<34;i++){const p=document.createElement('i');p.style.left=(Math.random()*100)+'vw';p.style.animationDelay=(Math.random()*0.4)+'s';p.style.background=Math.random()<.5?'linear-gradient(#80ffea,#4e9cff)':'linear-gradient(#ffd166,#ff3d7f)';confetti.appendChild(p)}setTimeout(()=>confetti.innerHTML='',1600)}
function vibr(ms){if(navigator.vibrate) navigator.vibrate(ms)}

/* ganador por √°ngulo */
function norm(v){return ((v%TWO)+TWO)%TWO}
function winnerIndex(a){let best=0,dist=1e9;for(let i=0;i<SEGS;i++){const center=norm(a+i*arc+arc/2);let d=Math.abs(norm(center-pointerAngle));if(d>Math.PI)d=TWO-d;if(d<dist){dist=d;best=i}}return best}

let spinning=false, lastTickIdx=winnerIndex(angle);
function animateTo(target,ms,done){
  const start=performance.now(), from=angle;
  (function loop(t){
    const k=Math.min(1,(t-start)/ms);
    const e=1-Math.pow(1-k,3);
    angle=from+(target-from)*e; draw(angle);

    // tick/ vibraci√≥n cuando cambia el segmento bajo el puntero
    const idx=winnerIndex(angle);
    if(idx!==lastTickIdx){
      lastTickIdx=idx; playBeep(900,0.04,0.15); vibr(10);
    }
    if(k<1){requestAnimationFrame(loop)} else {done&&done()}
  })(start);
}

/* acciones */
spinBtn.addEventListener('click',()=>{
  if(isExpired()) return toastMsg('La promoci√≥n finaliz√≥');
  if(localStorage.getItem('spin_done')==='1') return toastMsg('Ya usaste tu giro de hoy');
  if(spinning) return;

  spinning=true; spinBtn.disabled=true; claimBtn.disabled=true;

  const extra=5+Math.random()*1.5, offset=Math.random()*TWO; const final=angle+(TWO*extra)+offset;
  animateTo(final,3400,()=>{
    angle=final; const idx=winnerIndex(angle); const prize=PRIZES[idx];
    setWon(prize); localStorage.setItem('spin_done','1'); localStorage.setItem('spin_prize',JSON.stringify(prize)); spinning=false;
  });
});
resetBtn.addEventListener('click',()=>{
  localStorage.removeItem('spin_done'); localStorage.removeItem('spin_prize');
  angle=0; lastTickIdx=winnerIndex(angle); draw(angle);
  pill.textContent='-'; titleEl.textContent='Ten√©s 1 giro disponible';
  subtitle.innerHTML='Los premios se acreditan con tu <b>pr√≥xima carga m√≠nima</b>.'; claimBtn.disabled=true;
});

function setWon(prize){
  const txt=prizeText(prize);
  pill.textContent=(prize.type==='%'? prize.value+'%':"$"+prize.value.toLocaleString("es-AR"));
  titleEl.textContent='üéâ ¬°Premio obtenido!'; subtitle.innerHTML=`Recib√≠s <b>${txt}</b> con tu pr√≥xima carga.`;
  claimBtn.disabled=false; fabWA.disabled=false;
  const msg=encodeURIComponent(waMsgFor(txt));
  claimBtn.onclick=()=>location.href=`https://wa.me/${WP}?text=${msg}`;
  fabWA.onclick=()=>location.href=`https://wa.me/${WP}?text=${msg}`;
  playWin(); vibr([40,60,40]); confettiBurst();
}

/* =================== Countdown 23:59 =================== */
const DK='promo_end_ts';
function today2359(){const n=new Date();const end=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,0,0);return end.getTime()>Date.now()?end.getTime():new Date(n.getFullYear(),n.getMonth(),n.getDate()+1,23,59,0,0).getTime()}
function deadline(){const s=parseInt(localStorage.getItem(DK)||'0',10);if(s>Date.now())return s;const e=today2359();localStorage.setItem(DK,String(e));return e}
function remain(){return Math.max(0,deadline()-Date.now())}
function fmt(ms){const t=Math.floor(ms/1000),h=Math.floor(t/3600),m=Math.floor((t%3600)/60),s=t%60;return (h>0?`${h}:`:'')+String(m).padStart(2,'0')+':'+String(s).padStart(2,'0')}
function isExpired(){return remain()<=0}
function tick(){countdownEl.textContent=fmt(remain())}
setInterval(tick,1000); tick();

/* =================== Init =================== */
setSize(); draw(angle);
/* FAB oculto si CTA visible */
const io=new IntersectionObserver(es=>{es.forEach(e=>{if(e.target.id==='claimBtn'){fabWA.style.display=e.isIntersecting?'none':'flex'}})},{threshold:.6});
io.observe(claimBtn);
/* FAB default si a√∫n no hay premio */
const defMsg=encodeURIComponent("Hola! Tengo una consulta sobre la promo."); fabWA.onclick=()=>location.href=`https://wa.me/${WP}?text=${defMsg}`; fabWA.disabled=false;
/* sonido off por defecto */
setSound(false);
</script>
</body>
</html>
